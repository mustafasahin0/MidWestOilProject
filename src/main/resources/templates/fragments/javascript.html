<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">

<body>

<div th:fragment="js">

  <!-- Optional JavaScript -->
  <!-- jquery 3.3.1 -->
<!--  <script th:src="@{/assets/vendor/jquery/jquery-3.3.1.min.js}"></script>-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
  <!-- bootstrap bundle js -->
  <script th:src="@{/assets/vendor/bootstrap/js/bootstrap.bundle.js}"></script>
  <!-- slimscroll js -->
  <script th:src="@{/assets/vendor/slimscroll/jquery.slimscroll.js}"></script>
  <!-- main js -->
  <script th:src="@{/assets/libs/js/main-js.js}"></script>
  <!-- chart chartist js -->
  <script th:src="@{/assets/vendor/charts/chartist-bundle/chartist.min.js}"></script>
  <!-- sparkline js -->
  <script th:src="@{/assets/vendor/charts/sparkline/jquery.sparkline.js}"></script>
  <!-- morris js -->
  <script th:src="@{/assets/vendor/charts/morris-bundle/raphael.min.js}"></script>
  <script th:src="@{/assets/vendor/charts/morris-bundle/morris.js}"></script>
  <!-- chart c3 js -->
  <script th:src="@{/assets/vendor/charts/c3charts/c3.min.js}"></script>
  <script th:src="@{/assets/vendor/charts/c3charts/d3-5.4.0.min.js}"></script>
  <script th:src="@{/assets/vendor/charts/c3charts/C3chartjs.js}"></script>
  <script th:src="@{/assets/libs/js/dashboard-ecommerce.js}"></script>
  <script th:src="@{/assets/vendor/datepicker/tempusdominus-bootstrap-4.js}"></script>
  <script th:src="@{/assets/vendor/datepicker/moment.js}"></script>
  <script th:src="@{/assets/vendor/datepicker/datepicker.js}"></script>

  <script>
    $(document).ready(function() {
      $('#sortableTable').DataTable();
    });
  </script>

  <script>
    let addedProducts = [];

    function addProduct() {
      const productSelect = document.getElementById('products');
      const selectedOptionIndex = productSelect.selectedIndex;

      // Check if an option is selected
      if (selectedOptionIndex <= 0) {
        alert('Please select a product');
        return;
      }

      const selectedOption = productSelect.options[selectedOptionIndex];
      const productName = selectedOption.textContent.trim();
      const productId = selectedOption.value;
      const quantity = document.getElementById('quantity').value;
      const price = document.getElementById('price').value;
      const subtotal = quantity * price;

      // Perform input validation for quantity and price here if needed

      addedProducts.push({
        id: productId,
        name: productName,
        quantity: quantity,
        price: price,
        subtotal: subtotal
      });

      const tableBody = document.getElementById('addedProductsTable').querySelector('tbody');
      const newRow = document.createElement('tr');

      newRow.innerHTML = `
        <td>${productName}</td>
        <td>${quantity}</td>
        <td>${price}</td>
        <td>${subtotal.toFixed(2)}</td>
        <td class="actions">
            <button type="button" class="btn btn-secondary btn-sm" onclick="removeProduct(${addedProducts.length - 1})">Remove</button>
        </td>
    `;

      tableBody.appendChild(newRow);
    }

    function removeProduct(index) {
      addedProducts.splice(index, 1);
      const tableBody = document.getElementById('addedProductsTable').querySelector('tbody');
      tableBody.innerHTML = '';

      addedProducts.forEach((product, idx) => {
        const newRow = document.createElement('tr');

        newRow.innerHTML = `
            <td>${product.name}</td>
            <td>${product.quantity}</td>
            <td>${product.price}</td>
            <td>${product.subtotal.toFixed(2)}</td>
            <td class="actions">
                <button type="button" class="btn btn-secondary btn-sm" onclick="removeProduct(${idx})">Remove</button>
            </td>
        `;

        tableBody.appendChild(newRow);
      });
    }
  </script>

</div>

</body>

</html>